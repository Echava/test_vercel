{
  "version": 3,
  "sources": ["../../svelte/src/internal/client/timing.js", "../../svelte/src/internal/client/loop.js"],
  "sourcesContent": ["/** @import { Raf } from '#client' */\r\nimport { noop } from '../shared/utils.js';\r\n\r\nimport { BROWSER } from 'esm-env';\r\n\r\nconst request_animation_frame = BROWSER ? requestAnimationFrame : noop;\r\n\r\nconst now = BROWSER ? () => performance.now() : () => Date.now();\r\n\r\n/** @type {Raf} */\r\nexport const raf = {\r\n\ttick: /** @param {any} _ */ (_) => request_animation_frame(_),\r\n\tnow: () => now(),\r\n\ttasks: new Set()\r\n};\r\n", "/** @import { TaskCallback, Task, TaskEntry } from '#client' */\r\nimport { raf } from './timing.js';\r\n\r\n// TODO move this into timing.js where it probably belongs\r\n\r\n/**\r\n * @param {number} now\r\n * @returns {void}\r\n */\r\nfunction run_tasks(now) {\r\n\traf.tasks.forEach((task) => {\r\n\t\tif (!task.c(now)) {\r\n\t\t\traf.tasks.delete(task);\r\n\t\t\ttask.f();\r\n\t\t}\r\n\t});\r\n\r\n\tif (raf.tasks.size !== 0) {\r\n\t\traf.tick(run_tasks);\r\n\t}\r\n}\r\n\r\n/**\r\n * Creates a new task that runs on each raf frame\r\n * until it returns a falsy value or is aborted\r\n * @param {TaskCallback} callback\r\n * @returns {Task}\r\n */\r\nexport function loop(callback) {\r\n\t/** @type {TaskEntry} */\r\n\tlet task;\r\n\r\n\tif (raf.tasks.size === 0) {\r\n\t\traf.tick(run_tasks);\r\n\t}\r\n\r\n\treturn {\r\n\t\tpromise: new Promise((fulfill) => {\r\n\t\t\traf.tasks.add((task = { c: callback, f: fulfill }));\r\n\t\t}),\r\n\t\tabort() {\r\n\t\t\traf.tasks.delete(task);\r\n\t\t}\r\n\t};\r\n}\r\n"],
  "mappings": ";;;;;;AAKA,IAAM,0BAA0B,UAAU,wBAAwB;AAElE,IAAM,MAAM,UAAU,MAAM,YAAY,IAAI,IAAI,MAAM,KAAK,IAAI;AAGxD,IAAM,MAAM;AAAA,EAClB;AAAA;AAAA,IAA4B,CAAC,MAAM,wBAAwB,CAAC;AAAA;AAAA,EAC5D,KAAK,MAAM,IAAI;AAAA,EACf,OAAO,oBAAI,IAAI;AAChB;;;ACLA,SAAS,UAAUA,MAAK;AACvB,MAAI,MAAM,QAAQ,CAAC,SAAS;AAC3B,QAAI,CAAC,KAAK,EAAEA,IAAG,GAAG;AACjB,UAAI,MAAM,OAAO,IAAI;AACrB,WAAK,EAAE;AAAA,IACR;AAAA,EACD,CAAC;AAED,MAAI,IAAI,MAAM,SAAS,GAAG;AACzB,QAAI,KAAK,SAAS;AAAA,EACnB;AACD;AAQO,SAAS,KAAK,UAAU;AAE9B,MAAI;AAEJ,MAAI,IAAI,MAAM,SAAS,GAAG;AACzB,QAAI,KAAK,SAAS;AAAA,EACnB;AAEA,SAAO;AAAA,IACN,SAAS,IAAI,QAAQ,CAAC,YAAY;AACjC,UAAI,MAAM,IAAK,OAAO,EAAE,GAAG,UAAU,GAAG,QAAQ,CAAE;AAAA,IACnD,CAAC;AAAA,IACD,QAAQ;AACP,UAAI,MAAM,OAAO,IAAI;AAAA,IACtB;AAAA,EACD;AACD;",
  "names": ["now"]
}
